source("functions/DC_loglike_time.R")
source("functions/DC_conj_prob.R")
source("functions/Maher_conj_prob.R")
source("functions/DC_result_probs.R")
source("functions/Maher_result_probs.R")
source("functions/result_pred.R")
source("functions/result_1X_2.R")
source("functions/result_1_X2.R")
#...............................................................................
#...............................................................................
# Data import and selection
serieA_2122<- read.csv("../data/serieA_21-22.csv")
serieA_2122<- serieA_2122[,c("HomeTeam", "AwayTeam", "FTHG", "FTAG", "FTR","Date")]
teams <- names(table(serieA_2122[,"HomeTeam"]))
serieA_2122<- team_dummies(serieA_2122)
#...............................................................................
#-----------------------
# STATIC DC PREDICTIONS
#-----------------------
DC_static_predictions_HDA<- vector(mode="character",length=190)
DC_static_predictions_1X_2<- vector(mode="character",length=190)
DC_static_predictions_1_X2<- vector(mode="character",length=190)
i=1
for (match in 20:38){
#test set for the current matchday
current_testset=serieA_2122[(10*match -9):(10*match),]
#load parameters estimated for the current matchday
filepath= paste("parameters/eps/par_list_",match,".RData",sep="")
load(filepath)
# The object loaded is called  "par_list"
current_eps_par=par_list[1:4]
current_matchday_predictions_HDA<- vector(mode="character",length=10)
current_matchday_predictions_1X_2<- vector(mode="character",length=10)
current_matchday_predictions_1_X2<- vector(mode="character",length=10)
for (m in 1:nrow(current_testset)){
# Get match teams
teamA= current_testset[m,"HomeTeam"]
teamB= current_testset[m,"AwayTeam"]
# Get the real result of the match
real_result= current_testset[m,"FTR"]
# Get probabilities H-D-A
HDA_probs=DC_result_probs(teamA,teamB,current_eps_par)
#Predict H-D-A, 1X-2 and 1-X2
predicted_FTR=  result_pred(HDA_probs)
predicted_1X_2=  result_1X_2(HDA_probs)
predicted_1_X2=  result_1_X2(HDA_probs)
#Insert predictions into array
current_matchday_predictions_HDA[m]=predicted_FTR
current_matchday_predictions_1X_2[m]=predicted_1X_2
current_matchday_predictions_1_X2[m]=predicted_1_X2
}
# Inserisco previsioni giornata su vettore previsioni
DC_static_predictions_HDA[i:(i+9)]<-current_matchday_predictions_HDA
DC_static_predictions_1X_2[i:(i+9)]<-current_matchday_predictions_1X_2
DC_static_predictions_1_X2[i:(i+9)]<-current_matchday_predictions_1_X2
# Aggiorno l'indice
i=i+10
}
#-----------------------
# DINAMIC DC PREDICTIONS
#-----------------------
DC_dinamic_predictions_HDA<- vector(mode="character",length=190)
DC_dinamic_predictions_1X_2<- vector(mode="character",length=190)
DC_dinamic_predictions_1_X2<- vector(mode="character",length=190)
i=1
for (match in 20:38){
#test set for the current matchday
current_testset=serieA_2122[(10*match -9):(10*match),]
#load parameters estimated for the current matchday
filepath= paste("parameters/eps/par_list_",match,".RData",sep="")
load(filepath)
# The object loaded is called  "par_list"
current_eps_par=par_list[21:24]
current_matchday_predictions_HDA<- vector(mode="character",length=10)
current_matchday_predictions_1X_2<- vector(mode="character",length=10)
current_matchday_predictions_1_X2<- vector(mode="character",length=10)
for (m in 1:nrow(current_testset)){
# Get match teams
teamA= current_testset[m,"HomeTeam"]
teamB= current_testset[m,"AwayTeam"]
# Get the real result of the match
real_result= current_testset[m,"FTR"]
# Get probabilities H-D-A
HDA_probs=DC_result_probs(teamA,teamB,current_eps_par)
#Predict H-D-A, 1X-2 and 1-X2
predicted_FTR=  result_pred(HDA_probs)
predicted_1X_2=  result_1X_2(HDA_probs)
predicted_1_X2=  result_1_X2(HDA_probs)
#Insert predictions into array
current_matchday_predictions_HDA[m]=predicted_FTR
current_matchday_predictions_1X_2[m]=predicted_1X_2
current_matchday_predictions_1_X2[m]=predicted_1_X2
}
# Inserisco previsioni giornata su vettore previsioni
DC_dinamic_predictions_HDA[i:(i+9)]<-current_matchday_predictions_HDA
DC_dinamic_predictions_1X_2[i:(i+9)]<-current_matchday_predictions_1X_2
DC_dinamic_predictions_1_X2[i:(i+9)]<-current_matchday_predictions_1_X2
# Aggiorno l'indice
i=i+10
}
#-------------------------------------------------------------------------------
# (1) ANALISI MATRICI DI CORRELAZIONE CON RISULTATO H-D-A
#-------------------------------------------------------------------------------
girone_ritorno_HDA<- serieA_2122[191:380,]
girone_ritorno_HDA$DCstaticpredictions= DC_static_predictions_HDA
girone_ritorno_HDA$DCdinamicpredictions= DC_dinamic_predictions_HDA
#Feature selections
girone_ritorno_HDA<- girone_ritorno_HDA[,c("FTR","DCstaticpredictions", "DCdinamicpredictions")]
#Confusion Matrices
#Libraries to build confusion matrix
library(tibble)
library(cvms)
multinomial_metrics(all = FALSE, balanced_accuracy = TRUE)
DCstatic_conf_mat_HDA<- confusion_matrix(targets = as.factor(girone_ritorno_HDA$FTR),
predictions =as.factor(girone_ritorno_HDA$DCstaticpredictions)
)
DCdinamic_conf_mat_HDA<- confusion_matrix(targets = as.factor(girone_ritorno_HDA$FTR),
predictions =as.factor(girone_ritorno_HDA$DCdinamicpredictions)
)
#Libraries to plot them
library(ggplot2)
source("functions/plot_confusionmatrix.R")
p1=plot_confusionmatrix(DCstatic_conf_mat_HDA,"Dixon-Coles model (static)")
p2=plot_confusionmatrix(DCdinamic_conf_mat_HDA,"Dixon-Coles model (dinamic)")
library(patchwork)
p1 + theme(plot.margin = unit(c(0,40,0,0), "pt")) +
(p2 + theme(plot.margin = unit(c(0,40,0,0), "pt")))
#-------------------------------------------------------------------------------
# (2) ANALISI MATRICI DI CORRELAZIONE CON RISULTATO 1X-2
#-------------------------------------------------------------------------------
girone_ritorno_1X_2<- serieA_2122[191:380,]
girone_ritorno_1X_2$DCstaticpredictions_1X_2= DC_static_predictions_1X_2
girone_ritorno_1X_2$DCdinamicpredictions_1X_2= DC_dinamic_predictions_1X_2
#Feature selections
girone_ritorno_1X_2<- girone_ritorno_1X_2[,c("FTR","DCstaticpredictions_1X_2", "DCdinamicpredictions_1X_2")]
#in questo modo però FTR ha 3 modalità mentre le previsioni solo 2 modalità
# PERÒ SI PUO CONSIDERARE UN PROBLEMA EQUIVALENTE PIÙ SEMPLICE DA IMPLEMENTARE
# Consideriamo l'evento "Squadra di Casa non Perdere"
# Per ogni partita potrò stabilire se
#   TRUE: la squadra di casa non perde (FTR=H oppure FTR=D)
#   FALSE: la squadra di casa perde (FTR=A)
#Metto dappertutto TRUE
girone_ritorno_1X_2$FTR_target= TRUE
# False quando FTR=A
girone_ritorno_1X_2$FTR_target[girone_ritorno_1X_2$FTR == 'A']= FALSE
#Adesso devo modificare le previsioni dei modelli. Come?
#   1X equivale a TRUE
#   2 equivale a FALSE
girone_ritorno_1X_2$DCstaticpredictions_1X_2=ifelse(girone_ritorno_1X_2$DCstaticpredictions_1X_2 == "1X", TRUE, FALSE)
girone_ritorno_1X_2$DCdinamicpredictions_1X_2=ifelse(girone_ritorno_1X_2$DCdinamicpredictions_1X_2 == "1X", TRUE, FALSE)
# Creo le matrici di confusione
DCstatic_conf_mat_1X_2<- confusion_matrix(targets = girone_ritorno_1X_2$FTR_target,
predictions =girone_ritorno_1X_2$DCstaticpredictions_1X_2
)
DCdinamic_conf_mat_1X_2<- confusion_matrix(targets =girone_ritorno_1X_2$FTR_target,
predictions =girone_ritorno_1X_2$DCdinamicpredictions_1X_2
)
source("functions/plot_confusionmatrix.R")
p3=plot_confusionmatrix(DCstatic_conf_mat_1X_2,"Dixon-Coles model (static)")
p4=plot_confusionmatrix(DCdinamic_conf_mat_1X_2,"Dixon-Coles model (dinamic)")
(p3 + theme(plot.margin = unit(c(0,35,0,0), "pt"))) +
(p4 + theme(plot.margin = unit(c(0,35,0,0), "pt")))
#-------------------------------------------------------------------------------
# (3) ANALISI MATRICI DI CORRELAZIONE CON RISULTATO 1-X2
#-------------------------------------------------------------------------------
girone_ritorno_1_X2<- serieA_2122[191:380,]
girone_ritorno_1_X2$DCstaticpredictions_1_X2= DC_static_predictions_1_X2
girone_ritorno_1_X2$DCdinamicpredictions_1_X2= DC_dinamic_predictions_1_X2
#Feature selections
girone_ritorno_1_X2<- girone_ritorno_1_X2[,c("FTR","DCstaticpredictions_1_X2", "DCdinamicpredictions_1_X2")]
# Consideriamo l'evento "Squadra di Casa Vincee"
# Per ogni partita potrò stabilire se
#   TRUE: la squadra di casa vince (FTR=H)
#   FALSE: la squadra di casa non vince (FTR=D o FTR=A)
#Metto dappertutto FALSE
girone_ritorno_1_X2$FTR_target= FALSE
# TRUE quando FTR=H
girone_ritorno_1_X2$FTR_target[girone_ritorno_1_X2$FTR == 'H']= TRUE
#Adesso devo modificare le previsioni dei modelli. Come?
#   1 equivale a TRUE
#   X2 equivale a FALSE
girone_ritorno_1_X2$DCstaticpredictions_1_X2=ifelse(girone_ritorno_1_X2$DCstaticpredictions_1_X2 == "1", TRUE, FALSE)
girone_ritorno_1_X2$DCdinamicpredictions_1_X2=ifelse(girone_ritorno_1_X2$DCdinamicpredictions_1_X2 == "1", TRUE, FALSE)
# Creo le matrici di confusione
DCstatic_conf_mat_1_X2<- confusion_matrix(targets = girone_ritorno_1_X2$FTR_target,
predictions =girone_ritorno_1_X2$DCstaticpredictions_1_X2
)
DCdinamic_conf_mat_1_X2<- confusion_matrix(targets =girone_ritorno_1_X2$FTR_target,
predictions =girone_ritorno_1_X2$DCdinamicpredictions_1_X2
)
source("functions/plot_confusionmatrix.R")
p4=plot_confusionmatrix(DCstatic_conf_mat_1_X2,"Dixon-Coles model (static)")
p5=plot_confusionmatrix(DCdinamic_conf_mat_1_X2,"Dixon-Coles model (dinamic)")
(p4 + theme(plot.margin = unit(c(0,35,0,0), "pt"))) +
(p5 + theme(plot.margin = unit(c(0,35,0,0), "pt")))
#-------------------------------------------------------------------------------
# (2) ANALISI MATRICI DI CORRELAZIONE CON RISULTATO 1X-2
#-------------------------------------------------------------------------------
girone_ritorno_1X_2<- serieA_2122[191:380,]
girone_ritorno_1X_2$DCstaticpredictions_1X_2= DC_static_predictions_1X_2
girone_ritorno_1X_2$DCdinamicpredictions_1X_2= DC_dinamic_predictions_1X_2
#Feature selections
girone_ritorno_1X_2<- girone_ritorno_1X_2[,c("FTR","DCstaticpredictions_1X_2", "DCdinamicpredictions_1X_2")]
#Metto dappertutto TRUE
girone_ritorno_1X_2$FTR_target= '1X'
# False quando FTR=A
girone_ritorno_1X_2$FTR_target[girone_ritorno_1X_2$FTR == 'A']= '2'
# Creo le matrici di confusione
DCstatic_conf_mat_1X_2<- confusion_matrix(targets = as.factor(girone_ritorno_1X_2$FTR_target),
predictions =as.factor(girone_ritorno_1X_2$DCstaticpredictions_1X_2)
)
p3=plot_confusionmatrix(DCstatic_conf_mat_1X_2,"Dixon-Coles model (static)")
p3
DCstatic_conf_mat_1X_2$Sensitivity
DCstatic_conf_mat_1X_2$`Pos Pred Value`
View(girone_ritorno_1X_2)
#-------------------------------------------------------------------------------
# (3) ANALISI MATRICI DI CORRELAZIONE CON RISULTATO 1-X2
#-------------------------------------------------------------------------------
girone_ritorno_1_X2<- serieA_2122[191:380,]
girone_ritorno_1_X2$DCstaticpredictions_1_X2= DC_static_predictions_1_X2
setwd("~/thesis/code")
# (4) ANALISI MATRICI DI CORRELAZIONE CON RISULTATO 1-X2
#-------------------------------------------------------------------------------
girone_ritorno_1_X2<- serieA_2122[191:380,]
# Libraries
source("functions/team_dummies.R")
source("functions/add_date_difference.R")
source("functions/DixonColes_tau.R")
source("functions/DC_relist_params.R")
source("functions/DC_loglike_time.R")
source("functions/DC_conj_prob.R")
source("functions/Maher_conj_prob.R")
source("functions/DC_result_probs.R")
source("functions/Maher_result_probs.R")
source("functions/result_pred.R")
source("functions/result_1X_2.R")
source("functions/result_1_X2.R")
# Data import and selection
serieA_2122<- read.csv("../data/serieA_21-22.csv")
serieA_2122<- serieA_2122[,c("HomeTeam", "AwayTeam", "FTHG", "FTAG", "FTR","Date")]
teams <- names(table(serieA_2122[,"HomeTeam"]))
serieA_2122<- team_dummies(serieA_2122)
#............................................
#-----------------------
# STATIC DC PREDICTIONS
#-----------------------
DC_static_predictions_HDA<- vector(mode="character",length=190)
DC_static_predictions_1X_2<- vector(mode="character",length=190)
DC_static_predictions_1_X2<- vector(mode="character",length=190)
i=1
for (match in 20:38){
#test set for the current matchday
current_testset=serieA_2122[(10*match -9):(10*match),]
#load parameters estimated for the current matchday
filepath= paste("parameters/eps/par_list_",match,".RData",sep="")
load(filepath)
# The object loaded is called  "par_list"
current_eps_par=par_list[1:4]
current_matchday_predictions_HDA<- vector(mode="character",length=10)
current_matchday_predictions_1X_2<- vector(mode="character",length=10)
current_matchday_predictions_1_X2<- vector(mode="character",length=10)
for (m in 1:nrow(current_testset)){
# Get match teams
teamA= current_testset[m,"HomeTeam"]
teamB= current_testset[m,"AwayTeam"]
# Get the real result of the match
real_result= current_testset[m,"FTR"]
# Get probabilities H-D-A
HDA_probs=DC_result_probs(teamA,teamB,current_eps_par)
#Predict H-D-A, 1X-2 and 1-X2
predicted_FTR=  result_pred(HDA_probs)
predicted_1X_2=  result_1X_2(HDA_probs)
predicted_1_X2=  result_1_X2(HDA_probs)
#Insert predictions into array
current_matchday_predictions_HDA[m]=predicted_FTR
current_matchday_predictions_1X_2[m]=predicted_1X_2
current_matchday_predictions_1_X2[m]=predicted_1_X2
}
# Inserisco previsioni giornata su vettore previsioni
DC_static_predictions_HDA[i:(i+9)]<-current_matchday_predictions_HDA
DC_static_predictions_1X_2[i:(i+9)]<-current_matchday_predictions_1X_2
DC_static_predictions_1_X2[i:(i+9)]<-current_matchday_predictions_1_X2
# Aggiorno l'indice
i=i+10
}
#-----------------------
# DINAMIC DC PREDICTIONS
#-----------------------
DC_dinamic_predictions_HDA<- vector(mode="character",length=190)
DC_dinamic_predictions_1X_2<- vector(mode="character",length=190)
DC_dinamic_predictions_1_X2<- vector(mode="character",length=190)
i=1
for (match in 20:38){
#test set for the current matchday
current_testset=serieA_2122[(10*match -9):(10*match),]
#load parameters estimated for the current matchday
filepath= paste("parameters/eps/par_list_",match,".RData",sep="")
load(filepath)
# The object loaded is called  "par_list"
current_eps_par=par_list[21:24]
current_matchday_predictions_HDA<- vector(mode="character",length=10)
current_matchday_predictions_1X_2<- vector(mode="character",length=10)
current_matchday_predictions_1_X2<- vector(mode="character",length=10)
for (m in 1:nrow(current_testset)){
# Get match teams
teamA= current_testset[m,"HomeTeam"]
teamB= current_testset[m,"AwayTeam"]
# Get the real result of the match
real_result= current_testset[m,"FTR"]
# Get probabilities H-D-A
HDA_probs=DC_result_probs(teamA,teamB,current_eps_par)
#Predict H-D-A, 1X-2 and 1-X2
predicted_FTR=  result_pred(HDA_probs)
predicted_1X_2=  result_1X_2(HDA_probs)
predicted_1_X2=  result_1_X2(HDA_probs)
#Insert predictions into array
current_matchday_predictions_HDA[m]=predicted_FTR
current_matchday_predictions_1X_2[m]=predicted_1X_2
current_matchday_predictions_1_X2[m]=predicted_1_X2
}
# Inserisco previsioni giornata su vettore previsioni
DC_dinamic_predictions_HDA[i:(i+9)]<-current_matchday_predictions_HDA
DC_dinamic_predictions_1X_2[i:(i+9)]<-current_matchday_predictions_1X_2
DC_dinamic_predictions_1_X2[i:(i+9)]<-current_matchday_predictions_1_X2
# Aggiorno l'indice
i=i+10
}
# (4) ANALISI MATRICI DI CORRELAZIONE CON RISULTATO 1-X2
#-------------------------------------------------------------------------------
girone_ritorno_1_X2<- serieA_2122[191:380,]
girone_ritorno_1_X2$DCstaticpredictions_1_X2= DC_static_predictions_1_X2
girone_ritorno_1_X2$DCdinamicpredictions_1_X2= DC_dinamic_predictions_1_X2
#Feature selections
girone_ritorno_1_X2<- girone_ritorno_1_X2[,c("FTR","DCstaticpredictions_1_X2", "DCdinamicpredictions_1_X2")]
View(girone_ritorno_1_X2)
#Metto dappertutto FALSE
girone_ritorno_1_X2$FTR_target= TRUE
# TRUE quando FTR=H
girone_ritorno_1_X2$FTR_target[girone_ritorno_1_X2$FTR == 'H']= FALSE
#Adesso devo modificare le previsioni dei modelli. Come?
#   1 equivale a TRUE
#   X2 equivale a FALSE
girone_ritorno_1_X2$DCstaticpredictions_1_X2=ifelse(girone_ritorno_1_X2$DCstaticpredictions_1_X2 == "X2", TRUE, FALSE)
girone_ritorno_1_X2$DCdinamicpredictions_1_X2=ifelse(girone_ritorno_1_X2$DCdinamicpredictions_1_X2 == "X2", TRUE, FALSE)
#Confusion Matrices
#Libraries to build confusion matrix
library(tibble)
library(cvms)
#Libraries to plot them
library(ggplot2)
source("functions/plot_confusionmatrix.R")
library(patchwork)
# Creo le matrici di confusione
DCstatic_conf_mat_1_X2<- confusion_matrix(targets = girone_ritorno_1_X2$FTR_target,
predictions =girone_ritorno_1_X2$DCstaticpredictions_1_X2
)
DCdinamic_conf_mat_1_X2<- confusion_matrix(targets =girone_ritorno_1_X2$FTR_target,
predictions =girone_ritorno_1_X2$DCdinamicpredictions_1_X2
)
p4=plot_confusionmatrix(DCstatic_conf_mat_1_X2,"Dixon-Coles model (static)")
p5=plot_confusionmatrix(DCdinamic_conf_mat_1_X2,"Dixon-Coles model (dinamic)")
(p4 + theme(plot.margin = unit(c(0,35,0,0), "pt"))) +
(p5 + theme(plot.margin = unit(c(0,35,0,0), "pt")))
DCstatic_conf_mat_1_X2$`Positive Class`
DCstatic_conf_mat_1_X2$`Pos Pred Value`
DCstatic_conf_mat_1_X2$`Neg Pred Value`
DCstatic_conf_mat_1_X2$Sensitivity
DCstatic_conf_mat_1_X2$`Balanced Accuracy`
DCstatic_conf_mat_1_X2$F1
DCstatic_conf_mat_1_X2$`Pos Pred Value`
DCstatic_conf_mat_1_X2$`Neg Pred Value`
DCstatic_conf_mat_1_X2$Sensitivity
DCdinamic_conf_mat_1_X2$Sensitivity
DCstatic_conf_mat_1_X2$F1
DCdinamic_conf_mat_1_X2$F1
setwd("~/Bsc thesis")
#_______________________________________________________________________________
#         About:    Analysis of home effect in football matches
#_______________________________________________________________________________
#-------------------------------------------------------------------------------
# Import dataset and libraries
serieA_2122<- read.csv("data/serieA_21-22.csv")
teams_list<- names(table(serieA_2122[,"HomeTeam"]))
library(ggplot2)
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# Define variables for goals scored/conceeded Home/Away
TeamHomeGoalsScored<- vector(mode="numeric", length=length(teams_list))
TeamAwayGoalsScored<- vector(mode="numeric", length=length(teams_list))
TeamHomeGoalsConceeded<- vector(mode="numeric", length=length(teams_list))
TeamAwayGoalsConceeded<- vector(mode="numeric", length=length(teams_list))
for (i in 1:length(teams_list)){
TeamHomeGoalsScored[i]<- sum(serieA_2122[serieA_2122$HomeTeam== teams_list[i],"FTHG"])
TeamAwayGoalsScored[i]<- sum(serieA_2122[serieA_2122$AwayTeam==teams_list[i],"FTAG"])
TeamHomeGoalsConceeded[i]<- sum(serieA_2122[serieA_2122$HomeTeam== teams_list[i],"FTAG"])
TeamAwayGoalsConceeded[i]<- sum(serieA_2122[serieA_2122$AwayTeam==teams_list[i],"FTHG"])
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# (1) GOAL SCORED
#-------------------------------------------------------------------------------
# Dataframe for ggplot
goalscored_df <- data.frame(Stadium=rep(c("Home", "Away"),each=20),
Teams=rep(teams_list,2),
Goals=c(TeamHomeGoalsScored,TeamAwayGoalsScored)
)
# Plot
ggplot(goalscored_df, aes(x=Teams, y=Goals, fill=Stadium)) +
geom_bar(stat="identity", width=0.6, position=position_dodge(),colour="black")+
scale_fill_manual(values = c("#145A32", "#52BE80"))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1,face="bold"))+
ggtitle("Goal scored Serie A 2021-22") +
theme(plot.title = element_text(hjust = 0.5,face="bold"))
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# (2) GOAL CONCEEDED
#-------------------------------------------------------------------------------
# Dataframe
goalconceeded_df <- data.frame(Stadium=rep(c("Home", "Away"),each=20),
Teams=rep(teams_list,2),
Goals=c(TeamHomeGoalsConceeded,TeamAwayGoalsConceeded)
)
# Plot
ggplot(goalconceeded_df, aes(x=Teams, y=Goals, fill=Stadium)) +
geom_bar(stat="identity", width=0.6, position=position_dodge(),colour="black")+
scale_fill_manual( values=c("#641E16", "#EC7063"))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1,face="bold"))+
ggtitle("Goal conceeded Serie A 2021-22") +
theme(plot.title = element_text(hjust = 0.5,face="bold"))
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# (3) GOAL SCORED/CONCEEDED DIFFERENCE HOME VS AWAY
#-------------------------------------------------------------------------------
# Dataframes
goal_scored_difference<- TeamHomeGoalsScored- TeamAwayGoalsScored
goal_conceeded_difference<- TeamHomeGoalsConceeded- TeamAwayGoalsConceeded
goal_scored_difference_df <- data.frame(teams_list,
goal_scored_difference
)
goal_conceeded_difference_df <- data.frame(teams_list,
goal_conceeded_difference
)
# Variable to color bars (green= GOOD ; red= BAD)
goal_scored_difference_df$color <- ifelse(goal_scored_difference_df$goal_scored_difference >= 0,
"#52BE80", "#EC7063")
goal_conceeded_difference_df$color <- ifelse(goal_conceeded_difference_df$goal_conceeded_difference >= 0,
"#EC7063", "#52BE80")
# Plots
ggplot(goal_scored_difference_df, aes(x = teams_list,
y = goal_scored_difference,
fill = color)) +
geom_bar(stat = "identity", width=0.6, position=position_dodge(),colour="black") +
scale_fill_identity() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1,face="bold"))+
labs(title = "Goal scored difference Home vs Away",
x = "",
y = "Goal scored difference")+
theme(plot.title = element_text(hjust = 0.5,face="bold"))
# Goal conceeded difference Home vs Away
ggplot(goal_conceeded_difference_df, aes(x = teams_list,
y = goal_conceeded_difference,
fill = color)) +
geom_bar(stat = "identity", width=0.6, position=position_dodge(),colour="black") +
scale_fill_identity() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1,face="bold"))+
labs(title = "Goal conceeded difference Home vs Away",
x = "",
y = "Goal conceeded difference")+
theme(plot.title = element_text(hjust = 0.5,face="bold"))
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# (4) USEFUL RESULTS
#-------------------------------------------------------------------------------
serieA_2122$useful<-  (serieA_2122$FTR=="H") | (serieA_2122$FTR=="D")
useful_results_home<- vector(mode="numeric", length=length(teams_list))
useful_results_away<- vector(mode="numeric", length=length(teams_list))
for (i in 1:length(teams_list)){
useful_results_home[i]<- sum(serieA_2122[serieA_2122$HomeTeam== teams_list[i],"useful"])
useful_results_away[i]<- sum(!serieA_2122[serieA_2122$AwayTeam== teams_list[i],"useful"])
}
# Useful results home and away
useful_results_df <- data.frame(Stadium=rep(c("Home", "Away"),each=20),
Teams=rep(teams_list,2),
Result=c(useful_results_home,useful_results_away)
)
ggplot(useful_results_df, aes(x=Teams, y=Result, fill=Stadium)) +
geom_bar(stat="identity", width=0.6, position=position_dodge(),colour="black")+
scale_fill_manual(values = c("#EC7063", "#52BE80"))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1,face="bold"))+
ggtitle("Useful results Serie A 2021-22") +
theme(plot.title = element_text(hjust = 0.5,face="bold"))
# Useful results difference home vs away
# Dataframe
useful_result_difference<- useful_results_home- useful_results_away
useful_result_difference_df <- data.frame(teams_list,
useful_result_difference
)
useful_result_difference_df$Better<- ifelse(useful_result_difference_df$useful_result_difference > 0,
"Home", "Away")
# Plot
ggplot(useful_result_difference_df, aes(x = teams_list,
y = useful_result_difference,
fill = Better)) +
geom_bar(stat = "identity", width=0.6, position=position_dodge(),colour="black") +
scale_fill_manual(values = c("#EC7063", "#52BE80"))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1,face="bold"))+
labs(title = "Useful result difference Home vs Away",
x = "",
y = "Useful result difference")+
theme(plot.title = element_text(hjust = 0.5,face="bold"))
#-------------------------------------------------------------------------------
